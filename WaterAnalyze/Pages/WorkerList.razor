@using Data
@inject WaterAnalyzeContext WaterAnalyzeContext
@inject NavigationManager Navigation;
@page "/workerList"


<MudCard Style="display: flex; width: 70%; height: 30%;margin-left: auto;margin-right: auto; margin-top: 5%; box-shadow: rgb(38, 57, 77) 0px 20px 30px -10px">
    <div Style="flex: 50%;">
        <MudImage Src='/img/paperOne.jpg' Style="width: 99%; object-fit: fill"></MudImage>
    </div>
    <div Style="flex: 50%;">
        <MudTable Hover="true" Breakpoint="Breakpoint.Sm" FixedHeader="true"
                    Items="@Elements"
                    GroupHeaderStyle="background-color:var(--mud-palette-background-grey)"
                    GroupFooterClass="mb-4"
                    Dense="true"
                    Filter="new Func<User,bool>(FilterFunc1)"
                    @ref="_tableRef">
            <ToolBarContent>
                @* <MudText Typo="Typo.h6">Periodic Elements</MudText> *@
                
                <MudTextField @bind-Value="searchString1" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0"></MudTextField>
                <MudSpacer />
                <MudButton Href="/analyzeInfo" Style="margin-left: auto;margin-right: auto;">Добавить сотрудника</MudButton>
            </ToolBarContent>
            <HeaderContent>
                <MudTh>Фамилия</MudTh>
                <MudTh>Имя</MudTh>
                <MudTh>Отчество</MudTh>
            </HeaderContent>
            <RowTemplate >
                <MudTd @onclick="() => NavigationToEditingWorker(context.Id.ToString())" DataLabel="Фамилия">@context.Surname</MudTd>
                <MudTd @onclick="() => NavigationToEditingWorker(context.Id.ToString())" DataLabel="Имя">@context.Name</MudTd>
                <MudTd @onclick="() => NavigationToEditingWorker(context.Id.ToString())" DataLabel="Отчество"> @context.Patronymic</MudTd>
            </RowTemplate>
        @*     <GroupFooterTemplate>
                <MudTh Class="mud-table-cell-custom-group mud-table-cell-custom-group-footer" colspan="5">Total Mass: @context.Items.Sum((e) => e.Molar)</MudTh>
            </GroupFooterTemplate> *@
        </MudTable>
    </div>



</MudCard>
 
@code {
    private MudTable<User> _tableRef;
    private string searchString1 = "";

    private IEnumerable<User> Elements = new List<User>();

    protected override async Task OnInitializedAsync()
    {
        Elements = WaterAnalyzeContext.Users.ToList();
    }

    public void ToDirectionInfo(int id)
    {
        Navigation.NavigateTo($"/sourceInfo/{id}");
    }

    private bool FilterFunc1(User element) => FilterFunc(element, searchString1);

    private bool FilterFunc(User element, string searchString)
    {
        if (string.IsNullOrWhiteSpace(searchString))
            return true;
        // if (WaterAnalyzeContext.Users.Where(x => x.Id == element.Id).First().Surname.Contains(searchString, StringComparison.OrdinalIgnoreCase))
        //     return true;
        // if (WaterAnalyzeContext.Users.Where(x => x.Id == element.UserId).First().Name.Contains(searchString, StringComparison.OrdinalIgnoreCase))
        //     return true;
        // if ($"{element.Number} {element.Position} {element.Molar}".Contains(searchString))
        //     return true;
        return false;
    }

    public void NavigationToEditingWorker(string worker)
    {
        Navigation.NavigateTo($"/analyzeInfo/{worker}");
    }
}